<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–æ–ª–ª–µ–∫—Ü–∏—è –∫ 14 —Ñ–µ–≤—Ä–∞–ª—è</title>

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (Suggest + Geocode) -->
  <script src="https://api-maps.yandex.ru/2.1/?apikey=41cc1bdf-35fa-4959-ae88-6493220031f0&lang=ru_RU&suggest_apikey=41cc1bdf-35fa-4959-ae88-6493220031f0" type="text/javascript"></script>

  <style>
    :root{
      --pad:16px;
      --bg:#F6F1EA;               /* –º–æ–ª–æ—á–Ω—ã–π */
      --surface:#FFFFFF;          /* –∫–∞—Ä—Ç–æ—á–∫–∏ */
      --text:#121212;
      --muted:#6B6B6B;
      --line:rgba(0,0,0,.08);
      --shadow:0 10px 26px rgba(0,0,0,.08);

      --accent:#7A1E2C;           /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π –±–æ—Ä–¥–æ */
      --accentSoft:rgba(122,30,44,.10);
      --accent2:#2B2B2B;          /* –≥—Ä–∞—Ñ–∏—Ç */
      --accent2Soft:rgba(43,43,43,.08);

      --pink:#D65B7B;
      --peach:#F2B2A3;
      --lilac:#B8A6FF;
      --mint:#8ED3C7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* –õ—ë–≥–∫–∞—è ‚Äú–ø—Ä–∞–∑–¥–Ω–∏—á–Ω–∞—è‚Äù —Ç–µ–∫—Å—Ç—É—Ä–∞ –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–æ–∫ (—á—É—Ç—å –±–æ–ª—å—à–µ 14 —Ñ–µ–≤—Ä–∞–ª—è) */
    body:before{
      content:"";
      position:fixed;
      inset:-60px;
      pointer-events:none;
      background:
        radial-gradient(900px 520px at 12% 0%, rgba(207,95,112,.16), transparent 60%),
        radial-gradient(820px 520px at 92% 8%, rgba(122,30,44,.12), transparent 60%),
        radial-gradient(900px 700px at 45% 100%, rgba(255,255,255,.55), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.32), rgba(255,255,255,0));
      opacity:1;
    }

    header{
      position:sticky;
      top:0;
      z-index:30;
      background: rgba(246,241,234,.86);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }

    .wrap{max-width:1024px;margin:0 auto;padding:var(--pad); position:relative; z-index:1;}
    .view{display:none}
    .view.active{display:block}

    /* –í–µ—Ä—Ö–Ω—è—è —à–∞–ø–∫–∞ */
    .topbar{ padding: 14px var(--pad) 10px; }
    .brandline{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    /* –ü—Ä–∞–∑–¥–Ω–∏—á–Ω–µ–µ, –Ω–æ –Ω–µ ‚Äú–∫–∏—Å–ª–æ—Ç–∞‚Äù */
    .kicker{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      color:#fff;
      font-weight: 800;
      letter-spacing:.2px;
      font-size: 13px;
      background: linear-gradient(90deg, rgba(122,30,44,.95), rgba(207,95,112,.95));
      box-shadow: 0 10px 24px rgba(122,30,44,.18);
    }

    .hgroup{margin-top:10px}
    .title{
      margin:0;
      font-size: 22px;
      line-height:1.18;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:6px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
      font-weight: 600;
    }
    .timer{
      font-size:13px;
      color: var(--accent);
      font-weight: 900;
      opacity:.95;
      white-space:nowrap;
      align-self:center;
    }

    /* –ü–∞–Ω–µ–ª—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ */
    .sort{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      margin: 10px 0 12px;
      flex-wrap:wrap;
    }
    .sortLeft{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .label{
      color:var(--muted);
      font-size:13px;
      font-weight:700;
    }

    select,input,textarea{
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius: 14px;
      width:100%;
      background: var(--surface);
      color: var(--text);
      outline:none;
      transition:.15s;
    }
    select:focus,input:focus,textarea:focus{
      border-color: rgba(122,30,44,.35);
      box-shadow: 0 0 0 3px rgba(122,30,44,.12);
    }

    .ghost{
      background: var(--surface);
      border:1px solid var(--line);
      color: var(--text);
      border-radius: 14px;
      padding: 12px 14px;
      cursor:pointer;
      font-weight:800;
      transition:.15s;
    }
    .ghost:hover{transform:translateY(-1px)}
    .ghost:active{transform:translateY(0)}

    /* –°–µ—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ */
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    @media(min-width:740px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .card{
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: 22px;
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      animation:fadeInUp .45s ease both;
    }
    @keyframes fadeInUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

    .imgbox{
      position:relative;
      aspect-ratio: 3/4;
      background:#eee;
      overflow:hidden;
    }
    .imgbox img{
      width:100%;
      height:100%;
      object-fit:cover;
      object-position:center top;
      display:block;
      transform: scale(1.01);
    }

    /* –ë–µ–π–¥–∂ –Ω–∞ —Ñ–æ—Ç–æ */
    .badge{
      position:absolute;
      left:12px;
      top:12px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.88);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0,0,0,.06);
      font-size: 12px;
      font-weight: 900;
      color: var(--accent);
    }

    .info{padding: 12px 12px 14px;}
    .pTitle{
      font-weight: 800;
      margin: 0 0 6px;
      line-height: 1.25;
      letter-spacing:.1px;
    }
    .price{
      font-size: 14px;
      margin-bottom: 10px;
      color: rgba(0,0,0,.78);
      font-weight: 750;
    }

    .controls{display:flex;gap:8px;align-items:center}
    .btn{
      flex:1;
      padding: 13px 14px;
      border-radius: 14px;
      border: none;
      background: linear-gradient(180deg, rgba(122,30,44,1), rgba(92,14,24,1));
      color:#fff;
      font-weight: 900;
      cursor:pointer;
      transition:.15s;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:scale(.98)}
    .pill{
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.18);
      font-size: 12px;
      margin-left: 8px;
      color: #fff;
      font-weight: 900;
      border: 1px solid rgba(255,255,255,.18);
    }

    /* Checkout */
    .checkout-card{
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .field{
      flex:1;
      min-width: 200px;
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom: 12px;
    }
    .note{font-size:12px;color:var(--muted)}
    .muted{color:var(--muted);font-size:14px}
    .total{font-weight:900;font-size:16px}
    .qtyline{display:flex;gap:8px;align-items:center}
    .qbtn{
      width:30px;height:30px;
      border-radius:10px;
      border:1px solid var(--line);
      background: var(--surface);
      cursor:pointer;
      font-weight:900;
    }
    .count{width:24px;text-align:center;display:inline-block;font-weight:900}
    .hidden{display:none}

    /* –ö—Ä—É–ø–Ω–µ–µ ¬´–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è¬ª –∏ ¬´–¢–æ—á–∫–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞¬ª */
    #deliveryWrap label, #pickupWrap label{ font-size:16px; font-weight:900; line-height:1.25; }
    #deliveryMethod, #pickupPoint{
      font-size:16px; padding:14px 16px; min-height:48px; border-radius:14px;
    }

    /* FAB –∫–æ—Ä–∑–∏–Ω–∞ */
    #fabCart{
      position: fixed; right: 16px; bottom: 16px; z-index: 1000;
      display: none; align-items: center; gap:10px;
      padding: 12px 16px;
      border: 1px solid rgba(255,255,255,.2);
      border-radius: 999px;
      background: var(--accent2);
      color: #fff;
      font-weight: 900;
      box-shadow: 0 14px 34px rgba(0,0,0,.18);
      cursor: pointer;
      font-size: 14px;
    }
    #fabCart .sep{opacity:.6}
    #fabCart:active{transform:scale(.98)}

    footer{
      text-align:center;
      color: rgba(0,0,0,.55);
      padding: 30px 0 44px;
      font-weight: 700;
    }
  
/* Floating hearts for 14 Feb */
.hearts{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;
  overflow:hidden;
}
.hearts span{
  position:absolute;
  bottom:-40px;
  font-size:22px;
  opacity:.18;
  color:#7A1E2C;
  animation: floatUp 18s linear infinite;
}
.hearts span:nth-child(1){left:5%; animation-duration:16s; font-size:18px}
.hearts span:nth-child(2){left:15%; animation-duration:22s; font-size:26px}
.hearts span:nth-child(3){left:28%; animation-duration:19s; font-size:20px}
.hearts span:nth-child(4){left:40%; animation-duration:25s; font-size:30px}
.hearts span:nth-child(5){left:52%; animation-duration:17s; font-size:22px}
.hearts span:nth-child(6){left:65%; animation-duration:23s; font-size:28px}
.hearts span:nth-child(7){left:78%; animation-duration:18s; font-size:20px}
.hearts span:nth-child(8){left:90%; animation-duration:26s; font-size:32px}

@keyframes floatUp{
  from{ transform:translateY(0) rotate(0deg); opacity:0 }
  10%{opacity:.22}
  to{ transform:translateY(-120vh) rotate(360deg); opacity:0 }
}


/* ===== 14 Feb Header upgrade ===== */
header{
  /* keep sticky/backdrop from base; add a subtle gradient edge */
  box-shadow: 0 10px 30px rgba(122,30,44,.06);
}
.topbar{
  position:relative;
  overflow:hidden;
}
.hero-decor{
  position:absolute;
  inset:-40px -20px auto -20px;
  height:180px;
  pointer-events:none;
  background:
    radial-gradient(240px 170px at 10% 40%, rgba(214,91,123,.20), transparent 66%),
    radial-gradient(280px 190px at 88% 28%, rgba(184,166,255,.16), transparent 70%),
    radial-gradient(360px 240px at 55% 0%, rgba(242,178,163,.18), transparent 62%),
    radial-gradient(520px 280px at 60% 95%, rgba(142,211,199,.10), transparent 70%);
  filter: blur(0px);
  opacity:1;
}
/* small sparkle hearts near the title */
.title:after{
  content:"  ‚ù§";
  color: rgba(122,30,44,.55);
  font-weight: 900;
  font-size: .95em;
  letter-spacing: 0;
}
.sub{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.sub:before{
  content:"‚ú®";
  opacity:.75;
}



/* Brand logo in header (right) */
.hero-logo{
  margin-left:auto;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:10px;
  padding:8px 10px;
  border-radius:16px;
  background: rgba(255,255,255,.55);
  border: 1px solid rgba(0,0,0,.06);
  backdrop-filter: blur(10px);
}
.hero-logo img{
  height:34px;
  width:auto;
  display:block;
}
.logo-text{
  font-weight: 950;
  letter-spacing: .8px;
  color: rgba(0,0,0,.78);
  font-size: 14px;
}

/* Extra header stickers (subtle, colorful) */
.header-stickers{
  position:absolute;
  right:18px;
  top:86px;
  width:280px;
  height:140px;
  pointer-events:none;
  opacity:.9;
  background-repeat:no-repeat;
  background-size:contain;
  background-position: top right;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='380' height='190' viewBox='0 0 380 190'%3E%3Cg fill='none' stroke-linecap='round' stroke-linejoin='round' stroke-width='4'%3E%3Cpath d='M290 42c10-14 32-14 42 0 10 14-2 34-21 46-19-12-31-32-21-46Z' stroke='%23D65B7B' opacity='.75'/%3E%3Cpath d='M330 112c8-12 26-12 34 0 8 12-1 28-17 38-16-10-25-26-17-38Z' stroke='%23B8A6FF' opacity='.65'/%3E%3Cpath d='M250 120c6-10 20-10 26 0 6 10-1 22-13 30-12-8-19-20-13-30Z' stroke='%238ED3C7' opacity='.6'/%3E%3Cpath d='M78 132c18-26 52-34 78-18 22 14 30 42 18 66-12 24-41 35-68 26' stroke='%23F2B2A3' opacity='.55'/%3E%3Cpath d='M86 124c-18 8-32 24-36 44' stroke='%237A1E2C' opacity='.35'/%3E%3C/g%3E%3C/svg%3E");
}

/* Make the right illustration bigger + softer */
.hero-illustration{
  opacity:.42;
  width:320px;
  height:260px;
  top:-26px;
  right:-8px;
  mix-blend-mode:multiply;
}

/* Right-side header illustration (line-art flower) */
.hero-illustration{
  position:absolute;
  top:-18px;
  right:-10px;
  width:240px;
  height:220px;
  pointer-events:none;
  opacity:.55;
  background-repeat:no-repeat;
  background-size:contain;
  background-position: top right;
  filter: blur(0px);
  /* inline SVG as background */
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='300' viewBox='0 0 320 300'%3E%3Cg fill='none' stroke='%237A1E2C' stroke-width='2.6' stroke-linecap='round' stroke-linejoin='round' opacity='0.9'%3E%3Cpath d='M210 70c-14 6-28 20-34 36-7 18-3 36 9 49 12 12 30 16 48 9 16-6 30-20 36-34'/%3E%3Cpath d='M244 58c-10 2-22 10-30 20-9 11-12 25-9 37'/%3E%3Cpath d='M268 86c-2 10-10 22-20 30-11 9-25 12-37 9'/%3E%3Cpath d='M228 160c8 18 6 40-7 59-15 22-43 34-70 30'/%3E%3Cpath d='M181 249c-25-4-49-21-62-46-14-27-12-58 3-82 14-22 40-36 66-36 27 0 52 14 65 37'/%3E%3Cpath d='M180 250c-8 14-20 26-36 34'/%3E%3Cpath d='M200 244c0 18-6 34-17 48'/%3E%3Cpath d='M160 150c-10-10-25-16-40-15-15 1-29 9-37 22'/%3E%3Cpath d='M100 190c-2 12 1 25 9 35 8 10 20 16 33 17'/%3E%3Cpath d='M170 188c-6 10-16 18-28 21'/%3E%3Cpath d='M188 162c-2 12-8 22-18 30'/%3E%3Cpath d='M126 118c8-18 25-31 45-33 21-2 41 9 53 27'/%3E%3Cpath d='M186 102c-10 6-20 14-26 25'/%3E%3Cpath d='M146 210c8 8 20 12 32 10'/%3E%3C/g%3E%3C/svg%3E");
}

/* Keep illustration behind content but above decor */
.topbar .hero-illustration{ z-index:0; }
.topbar .brandline, .topbar .hgroup{ position:relative; z-index:1; }

/* ===== Floating hearts: more, smoother ===== */
.hearts{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;
  overflow:hidden;
}
.hearts span{
  position:absolute;
  bottom:-50px;
  font-size:20px;
  opacity:.14;
  color:#7A1E2C;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.08));
  animation-name: floatUp;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  will-change: transform, opacity;
}
.hearts span.soft{ opacity:.10; }
.hearts span.strong{ opacity:.20; }

@keyframes floatUp{
  from{ transform:translateY(0) translateX(0) rotate(0deg); opacity:0 }
  8%{opacity: var(--o, .16)}
  55%{opacity: var(--o, .16)}
  to{ transform:translateY(-130vh) translateX(var(--x, 0px)) rotate(420deg); opacity:0 }
}

</style>
</head>

<body>

<div class="hearts" id="heartsLayer"></div>
<header>
    <div class="topbar">
      <div class="hero-decor" aria-hidden="true"></div>
      <div class="hero-illustration" aria-hidden="true"></div>
      <div class="header-stickers" aria-hidden="true"></div>
      <div class="brandline">
        <div class="kicker">–ö–æ–ª–ª–µ–∫—Ü–∏—è ‚Ä¢ 14 —Ñ–µ–≤—Ä–∞–ª—è</div>
        <div id="timer" class="timer"></div>
      
        <div class="hero-logo" aria-label="SIMPLE">
          <img id="brandLogo" src="./images/logo.png" alt="SIMPLE" onerror="this.style.display='none';document.getElementById('logoText').style.display='block';">
          <div id="logoText" class="logo-text" style="display:none;">SIMPLE</div>
        </div>
      </div>

      <div class="hgroup">
        <h1 class="title">–ö–æ–º–ø–ª–∏–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–æ–º–Ω—è—Ç</h1>
        <div class="sub">–î–∞—Ä–∏—Ç—å —Ü–≤–µ—Ç—ã –ø—Ä–æ—Å—Ç–æ. –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –¢—é–º–µ–Ω–∏ ‚Ä¢ 08:30‚Äì21:00</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- CATALOG -->
    <section id="view-catalog" class="view active">
      <div class="sort">
        <div class="sortLeft">
          <span class="label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
          <select id="sortSel" style="width:220px">
            <option value="default">–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
            <option value="asc">—Ü–µ–Ω–∞ ‚Üë</option>
            <option value="desc">—Ü–µ–Ω–∞ ‚Üì</option>
          </select>
        </div>
        <button id="goCheckout" class="ghost">–ö–æ—Ä–∑–∏–Ω–∞</button>
      </div>

      <div id="grid" class="grid"></div>
    </section>

    <!-- CHECKOUT -->
    <section id="view-checkout" class="view">
      <div class="checkout-card">
        <div class="row">
          <div><b>–í–∞—à –∑–∞–∫–∞–∑</b> <span class="pill" id="cartCount">0 —Ç–æ–≤–∞—Ä–æ–≤</span></div>
          <button id="backToCatalog" class="ghost" style="min-width:120px">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="orderList" class="muted"></div>

        <div class="row"><b>–ó–∞–∫–∞–∑—á–∏–∫</b></div>
        <div class="row">
          <div class="field"><label>–ò–º—è</label><input id="customerName" autocomplete="name" /></div>
          <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="customerPhone" inputmode="tel" autocomplete="tel" /></div>
        </div>

        <div class="field">
          <label><input type="checkbox" id="samePerson" /> –ü–æ–ª—É—á–∞—Ç–µ–ª—å = –ó–∞–∫–∞–∑—á–∏–∫</label>
        </div>

        <div id="recipientFields">
          <div class="row"><b>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</b></div>
          <div class="row">
            <div class="field"><label>–ò–º—è</label><input id="recipientName" /></div>
            <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="recipientPhone" inputmode="tel" /></div>
          </div>
        </div>

        <div class="field" id="deliveryWrap">
          <label>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</label>
          <select id="deliveryMethod">
            <option value="pickup">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
            <option value="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</option>
          </select>
        </div>

        <div id="pickupWrap" class="field">
          <label>–¢–æ—á–∫–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞</label>
          <select id="pickupPoint">
            <option value="polevaya">–ü–æ–ª–µ–≤–∞—è, 109—Å9</option>
            <option value="burlaki">–ë—É—Ä–ª–∞–∫–∏, 2–∞–∫3</option>
          </select>
        </div>

        <div id="addrWrap" class="field hidden">
          <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
          <input id="address" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å..." />
          <div class="note">–î–æ–ø—É—Å—Ç–∏–º—ã –∞–¥—Ä–µ—Å–∞ —Ç–æ–ª—å–∫–æ –≤ –≥. –¢—é–º–µ–Ω–∏ –∏–ª–∏ –¢—é–º–µ–Ω—Å–∫–æ–º —Ä–∞–π–æ–Ω–µ.</div>
        </div>

        <div class="row">
          <div class="field"><label>–î–∞—Ç–∞</label><input id="date" type="date" /></div>
          <div class="field">
            <label>–í—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç (1 —á–∞—Å)</label>
            <select id="timeSlot"></select>
          </div>
        </div>

        <div class="field">
          <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
          <textarea id="comment" rows="3" placeholder="–û—Ç–∫—Ä—ã—Ç–∫–∞, –¥–æ–º–æ—Ñ–æ–Ω, –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
        </div>

        <div class="row">
          <div class="total">
            –¢–æ–≤–∞—Ä—ã: <span id="subtotalText">0 ‚ÇΩ</span><br>
            –î–æ—Å—Ç–∞–≤–∫–∞: <span id="feeText">0 ‚ÇΩ</span><br>
            <span class="note" id="freeNote"></span><br>
            –ò—Ç–æ–≥–æ: <span id="totalText">0 ‚ÇΩ</span>
          </div>
          <button id="sendOrder" class="btn" style="min-width:200px">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
      </div>
    </section>

    <footer>üïò –ü–Ω‚Äì–í—Å 08:30‚Äì21:00 ‚Ä¢ üõµ –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –¢—é–º–µ–Ω–∏</footer>
  </div>

  <!-- FAB –∫–æ—Ä–∑–∏–Ω—ã -->
  <button id="fabCart" aria-label="–û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É">
    üõí <span id="fabCount">0</span> <span class="sep">‚Ä¢</span> <span id="fabTotal">0 ‚ÇΩ</span>
  </button>

<script>
/* ====== –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ====== */
const DELIVERY = { byZone: { city: 350, suburb: 350, far: 500 }, freeFrom: 4000, defaultZone: 'city' };
const SLOT_WINDOWS = {
  delivery: { startMin: 9*60+30, endMin: 21*60+30 }, // 09:30‚Äì21:30
  pickup:   { startMin: 8*60+30, endMin: 21*60    }  // 08:30‚Äì21:00
};

let PRODUCTS = [];
fetch('./products.json').then(r => r.json()).then(list => { PRODUCTS = list; init(); })
  .catch(_ => { PRODUCTS = []; init(); });

const tg = window.Telegram?.WebApp; if (tg) tg.expand();
const cart = JSON.parse(sessionStorage.getItem('cart')||'{}');
function save(){ sessionStorage.setItem('cart', JSON.stringify(cart)); }
function formatPrice(n){ return n.toLocaleString('ru-RU') + ' ‚ÇΩ'; }

/* ====== –¢–∞–π–º–µ—Ä (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä—è—á–µ–º) ====== */
(function(){
  const t = document.getElementById('timer');
  if (t && !t.textContent) t.style.opacity = .0;
})();


/* ====== Floating hearts generator ====== */
(function(){
  const layer = document.getElementById('heartsLayer');
  if(!layer) return;
  const count = 48; // more hearts
  const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
  const seed = Math.floor(Math.random()*1e9);
  function rnd(n){ // deterministic-ish
    const x = Math.sin((seed + n) * 999) * 10000;
    return x - Math.floor(x);
  }
  for(let i=0;i<count;i++){
    const s = document.createElement('span');
    s.textContent = '‚ù§';
    const left = Math.floor(rnd(i)*100);
    const size = 14 + Math.floor(rnd(i+7)*24); // 14..38
    const dur  = 14 + Math.floor(rnd(i+21)*18); // 14..31s
    const delay= -Math.floor(rnd(i+99)*dur);   // negative -> already in motion
    const drift= Math.floor((rnd(i+33)-0.5) * 120); // -60..60px
    const cls  = rnd(i+55) > 0.7 ? 'strong' : (rnd(i+55) < 0.25 ? 'soft' : '');
    s.className = cls;
    s.style.left = left + '%';
    s.style.fontSize = size + 'px';
    s.style.animationDuration = dur + 's';
    s.style.animationDelay = delay + 's';
    s.style.setProperty('--x', drift + 'px');
    s.style.setProperty('--o', (cls==='strong'?0.20:(cls==='soft'?0.10:0.14)));
    layer.appendChild(s);
  }
})();


/* ====== –Ø–Ω–¥–µ–∫—Å: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–∞ ====== */
let addressValid = false;
let lastGeocodedAddress = "";
function geocodeValidate(address){
  return new Promise((resolve)=>{
    if (!window.ymaps || !address) return resolve(false);
    ymaps.geocode(address, { results: 1 }).then(res=>{
      if (res.geoObjects.getLength() > 0){
        const obj = res.geoObjects.get(0);
        const line = obj.getAddressLine && obj.getAddressLine() ? obj.getAddressLine() : address;
        const parts = (obj.getLocalities?.()||[]).join(' ') + " " + (obj.getAdministrativeAreas?.()||[]).join(' ');
        const allowed = /–¢—é–º–µ–Ω—å/i.test(parts) || /–¢—é–º–µ–Ω—Å–∫/i.test(parts);
        if (allowed){ lastGeocodedAddress = line; return resolve(true); }
      }
      resolve(false);
    }).catch(()=> resolve(false));
  });
}

/* ====== –¢–µ–ª–µ—Ñ–æ–Ω: –º–∞—Å–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è ====== */
function applyPhoneMask(el){
  function onlyDigits(s){ return s.replace(/\D/g,''); }
  el.addEventListener('input', ()=>{
    let d = onlyDigits(el.value);
    if (d.startsWith('8')) d = '7'+d.slice(1);
    if (!d.startsWith('7')) d = '7' + d;
    d = d.slice(0,11);
    let out = '+7';
    if (d.length>1) out += ' (' + d.slice(1,4);
    if (d.length>=4) out += ') ' + d.slice(4,7);
    if (d.length>=7) out += '-' + d.slice(7,9);
    if (d.length>=9) out += '-' + d.slice(9,11);
    el.value = out;
  });
}
function isPhoneValid(masked){
  const digits = masked.replace(/\D/g,'');
  return digits.length===11 && digits.startsWith('7');
}
function phoneDigits(masked){ return masked.replace(/\D/g,''); }

/* ====== –°–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ ====== */
function minutesToHHMM(mins){
  const h=String(Math.floor(mins/60)).padStart(2,'0');
  const m=String(mins%60).padStart(2,'0');
  return `${h}:${m}`;
}
function generateHourSlots(dateStr, method){
  const { startMin, endMin } = SLOT_WINDOWS[method];
  const now = new Date();
  const minStartTs = new Date(now.getTime()+2*60*60*1000); // +2 —á–∞—Å–∞
  const day = new Date(dateStr + 'T00:00:00');

  const slots = [];
  for (let m = startMin; m+60 <= endMin; m += 60){
    const from = minutesToHHMM(m);
    const to   = minutesToHHMM(m+60);
    const slotStart = new Date(`${dateStr}T${from}:00`);
    if (day > new Date(now.getFullYear(), now.getMonth(), now.getDate()) || slotStart >= minStartTs){
      slots.push({value: from, label: `${from}‚Äì${to}`});
    }
  }
  return slots;
}
function ensureDateHasSlots(method){
  const dateEl = document.getElementById('date');
  const timeEl = document.getElementById('timeSlot');
  let d = dateEl.value;
  if (!d){
    const today = new Date();
    d = today.toISOString().slice(0,10);
    dateEl.value = d;
  }
  let slots = generateHourSlots(d, method);
  if (slots.length===0){
    const dt = new Date(d+'T00:00:00'); dt.setDate(dt.getDate()+1);
    d = dt.toISOString().slice(0,10);
    dateEl.value = d;
    slots = generateHourSlots(d, method);
  }
  timeEl.innerHTML = slots.map(s=>`<option value="${s.value}">${s.label}</option>`).join('');
}

/* ====== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ====== */
function init(){
  document.getElementById('goCheckout').addEventListener('click', e=>{ e.preventDefault(); showCheckout(); });
  document.getElementById('backToCatalog').onclick = showCatalog;
  document.getElementById('sendOrder').onclick = sendOrder;
  document.getElementById('sortSel').addEventListener('change', renderCatalog);
  document.getElementById('fabCart').addEventListener('click', showCheckout);

  if (tg) tg.onEvent('mainButtonClicked', showCheckout);

  document.getElementById('samePerson').addEventListener('change', e=>{
    const hide = e.target.checked;
    document.getElementById('recipientFields').style.display = hide ? 'none' : 'block';
    if (hide){
      document.getElementById('recipientName').value  = document.getElementById('customerName').value;
      document.getElementById('recipientPhone').value = document.getElementById('customerPhone').value;
    }
  });

  if (window.ymaps) {
    ymaps.ready(()=>{
      const suggest = new ymaps.SuggestView('address');
      suggest.events.add('select', async (e)=>{
        const val = e.get('item')?.value || document.getElementById('address').value;
        addressValid = await geocodeValidate(val);
        if (addressValid) document.getElementById('address').value = lastGeocodedAddress || val;
      });
    });
  }
  document.getElementById('address').addEventListener('input', ()=>{ addressValid=false; });

  applyPhoneMask(document.getElementById('customerPhone'));
  applyPhoneMask(document.getElementById('recipientPhone'));

  const LS_KEY = 'simpetyumen_customer';
  const saved = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
  if (saved.name)  document.getElementById('customerName').value  = saved.name;
  if (saved.phone) document.getElementById('customerPhone').value = saved.phone;
  ['customerName','customerPhone'].forEach(id=>{
    document.getElementById(id).addEventListener('input', ()=>{
      localStorage.setItem(LS_KEY, JSON.stringify({
        name:  document.getElementById('customerName').value.trim(),
        phone: document.getElementById('customerPhone').value.trim()
      }));
    });
  });

  const methodSel = document.getElementById('deliveryMethod');
  const addrWrap  = document.getElementById('addrWrap');
  methodSel.addEventListener('change', ()=>{
    if (methodSel.value === 'delivery') addrWrap.classList.remove('hidden');
    else addrWrap.classList.add('hidden');
    ensureDateHasSlots(methodSel.value);
    renderCheckout();
  });

  document.getElementById('date').addEventListener('change', ()=>{
    ensureDateHasSlots(methodSel.value);
  });

  const today = new Date();
  document.getElementById('date').value = today.toISOString().slice(0,10);
  ensureDateHasSlots(methodSel.value);

  renderCatalog();
  renderCheckout();
  updateCartUI();
}

/* ====== –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ / –∫–æ—Ä–∑–∏–Ω—ã ====== */
function renderCatalog(){
  const grid = document.getElementById('grid');
  let list = PRODUCTS.slice();
  const sortSel = document.getElementById('sortSel')?.value || 'default';
  list.sort((a,b)=>{
    const pa = Number(a.price.toString().replace(/\D/g,''))||0;
    const pb = Number(b.price.toString().replace(/\D/g,''))||0;
    if (sortSel==='asc') return pa-pb;
    if (sortSel==='desc') return pb-pa;
    return 0;
  });

  grid.innerHTML = '';
  list.forEach(p=>{
    const qty = cart[p.id]||0;
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div class="imgbox">
        <img src="./images/${p.img}" alt="" loading="lazy">
        <div class="badge">14 —Ñ–µ–≤—Ä–∞–ª—è</div>
      </div>
      <div class="info">
        <div class="pTitle">${p.title}</div>
        <div class="price">${formatPrice(Number(p.price.toString().replace(/\D/g,'')))}</div>
        <div class="controls">
          <button class="btn add" data-id="${p.id}">–í –∫–æ—Ä–∑–∏–Ω—É ${qty>0?`<span class="pill">${qty}</span>`:''}</button>
        </div>
      </div>`;
    el.querySelector('.add').onclick = e=>{
      const id=e.currentTarget.dataset.id;
      cart[id]=(cart[id]||0)+1;
      save();
      renderCatalog();
      if (document.getElementById('view-checkout').classList.contains('active')) renderCheckout();
      updateCartUI();
    };
    grid.appendChild(el);
  });
}

function buildPayload(){
  const items = Object.entries(cart).map(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    const priceNum = Number(p.price.toString().replace(/\D/g,''))||0;
    return {id,title:p.title,price:priceNum,qty,amount:priceNum*qty};
  });
  const total = items.reduce((s,i)=>s+i.amount,0);
  return {items,total};
}

function calcDelivery(subtotal){
  const method = document.getElementById('deliveryMethod').value;
  if (method==='pickup') return 0;
  if (subtotal >= DELIVERY.freeFrom) return 0;
  return DELIVERY.byZone.city;
}

function renderCheckout(){
  const payload = buildPayload();
  document.getElementById('cartCount').textContent = payload.items.length+" —Ç–æ–≤–∞—Ä(–∞)";

  const listEl=document.getElementById('orderList');
  listEl.innerHTML=payload.items.map(i=>`
    <div class="row">
      <div style="flex:1">${i.title}</div>
      <div class="qtyline">
        <button class="qbtn" data-id="${i.id}" data-act="dec">‚àí</button>
        <span class="count">${i.qty}</span>
        <button class="qbtn" data-id="${i.id}" data-act="inc">+</button>
      </div>
      <div style="min-width:90px;text-align:right">${formatPrice(i.amount)}</div>
    </div>`).join("");
  listEl.querySelectorAll('.qbtn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const id=e.currentTarget.dataset.id;
      const act=e.currentTarget.dataset.act;
      if(act==='inc') cart[id]=(cart[id]||0)+1;
      else { if((cart[id]||0)>1) cart[id]-=1; else delete cart[id]; }
      save(); renderCheckout(); updateCartUI();
    });
  });

  const subtotal=payload.total;
  const fee=calcDelivery(subtotal);
  const total=subtotal+fee;

  document.getElementById('subtotalText').textContent=formatPrice(subtotal);
  const feeEl = document.getElementById('feeText');
  const freeNote = document.getElementById('freeNote');
  const method = document.getElementById('deliveryMethod').value;
  if (method==='delivery' && subtotal>=DELIVERY.freeFrom){
    feeEl.textContent = "0 ‚ÇΩ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)";
    freeNote.textContent = `–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –æ—Ç ${DELIVERY.freeFrom.toLocaleString('ru-RU')} ‚ÇΩ`;
  } else if (method==='delivery') {
    feeEl.textContent = formatPrice(fee);
    freeNote.textContent = `–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –æ—Ç ${DELIVERY.freeFrom.toLocaleString('ru-RU')} ‚ÇΩ`;
  } else {
    feeEl.textContent = "0 ‚ÇΩ";
    freeNote.textContent = "";
  }
  document.getElementById('totalText').textContent=formatPrice(total);
}

function showCheckout(){
  if(Object.keys(cart).length===0) return alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");
  document.getElementById('view-catalog').classList.remove('active');
  document.getElementById('view-checkout').classList.add('active');
  renderCheckout();
}

function showCatalog(){
  document.getElementById('view-checkout').classList.remove('active');
  document.getElementById('view-catalog').classList.add('active');
  renderCatalog();
  updateCartUI();
}

function updateCartUI(){
  const payload = buildPayload();
  const items = payload.items.reduce((s,i)=>s+i.qty,0);
  const total = payload.total;

  if (tg){
    if (items>0){
      tg.MainButton.setText(`–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ (${items}) ‚Ä¢ ${total.toLocaleString('ru-RU')} ‚ÇΩ`).show();
    } else {
      tg.MainButton.hide();
    }
  }

  const fab = document.getElementById('fabCart');
  const fabCount = document.getElementById('fabCount');
  const fabTotal = document.getElementById('fabTotal');
  if (items>0){
    fabCount.textContent = String(items);
    fabTotal.textContent = `${total.toLocaleString('ru-RU')} ‚ÇΩ`;
    fab.style.display = 'inline-flex';
  } else {
    fab.style.display = 'none';
  }
}

/* ====== –û—Ç–ø—Ä–∞–≤–∫–∞ ====== */
async function sendOrder(){
  const payload=buildPayload();
  if(!payload.items.length) return alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");

  const method=document.getElementById('deliveryMethod').value;
  const fee=calcDelivery(payload.total);

  const samePerson=document.getElementById('samePerson').checked;

  const form={
    customerName: document.getElementById('customerName').value.trim(),
    customerPhone: document.getElementById('customerPhone').value.trim(),
    recipientName: document.getElementById('recipientName').value.trim(),
    recipientPhone: document.getElementById('recipientPhone').value.trim(),
    address: document.getElementById('address').value.trim(),
    date: document.getElementById('date').value,
    time: document.getElementById('timeSlot').selectedOptions[0]?.textContent || '',
    timeStart: document.getElementById('timeSlot').value || '',
    comment: document.getElementById('comment').value.trim(),
    pickupPoint: document.getElementById('pickupPoint').value
  };

  if(!form.customerName) return alert("–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∑–∞–∫–∞–∑—á–∏–∫–∞");
  if(!isPhoneValid(form.customerPhone)) return alert("–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫–∞–∑—á–∏–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (XXX) XXX-XX-XX");
  if(!form.date) return alert("–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É");
  if(!form.timeStart) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç");

  if(!samePerson){
    if(!form.recipientName) return alert("–£–∫–∞–∂–∏—Ç–µ –∏–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è");
    if(!isPhoneValid(form.recipientPhone)) return alert("–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (XXX) XXX-XX-XX");
  } else {
    form.recipientName=form.customerName;
    form.recipientPhone=form.customerPhone;
  }

  if(method==='delivery'){
    if(!form.address) return alert("–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏");
    if(!addressValid){
      addressValid = await geocodeValidate(form.address);
      if(addressValid) form.address = lastGeocodedAddress||form.address;
    }
    if(!addressValid) return alert("–ê–¥—Ä–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≥. –¢—é–º–µ–Ω—å –∏–ª–∏ –¢—é–º–µ–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞");
  }

  const now = new Date();
  const minStartTs = new Date(now.getTime()+2*60*60*1000);
  const slotStart = new Date(`${form.date}T${form.timeStart}:00`);
  if (slotStart < minStartTs){
    return alert("–ù–∞—á–∞–ª–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞");
  }

  const items=payload.items.map(i=>({
    name:i.title,
    price:i.price.toLocaleString('ru-RU')+' ‚ÇΩ',
    qty:i.qty
  }));

  const tgUser = tg?.initDataUnsafe?.user || null;

  const body={
    customer:{ name:form.customerName, phone:phoneDigits(form.customerPhone) },
    recipient:{ name:form.recipientName, phone:phoneDigits(form.recipientPhone) },
    deliveryMethod:method,
    pickupPoint:form.pickupPoint,
    address:form.address,
    date:form.date,
    time:form.time,
    comment:form.comment,
    items,
    source:'–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
    total:payload.total,
    fee,
    timePlaced:new Date().toISOString(),
    tgUser
  };

  const resp=await fetch('/api/sendOrder',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(body)
  });
  const json=await resp.json().catch(()=>({}));
  if(resp.ok&&json.ok){
    alert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
    for(const k in cart) delete cart[k];
    save();
    updateCartUI();
    showCatalog();
  } else {
    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞");
  }
}
</script>
</body>
</html>
